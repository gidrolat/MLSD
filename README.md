# Анализ отзывов и sentiment analysis

# Авторы

| ФИО                       | Группа        |
|---------------------------|---------------|
| Мусаелян Ярослав Александрович    | М80-407Б-21   |
| Шумилова Александра Алексеевна| М80-407Б-21 |
|Ползикова Алина Владимировна | М80-408Б-21   |

# Презентация проекта

https://docs.google.com/presentation/d/1RcDgbWmCSz3WdvlbDuvmyTPxF1VeolZCngLJPz-5qYo/edit?usp=sharing

# Отчетность

## Описание
Анализ отзывов и sentiment analysis - проект для анализа текстов отзывов, комментариев, в основе которого лежит модель VADER.

## Бизнес - цель
Бизнес-цель данного проекта заключается в выявлении настроений и мнений клиентов о каком-то бренде или продукте. Основные направления для использования:
* Мониторинг клиентского опыта: Анализ текстов пользователей на различных информационных платформах помогает в оценки настроений по категориям(нейтральные, положительные, отрицательные), которые можно использовать для выявления ключевых проблем, упомянутых в отзывах.
* Улучшение поддержки клиентов:  Определение настроения клиента из текста отзыва, которое можно использовать для приоритизации обработки отзывов, комментариев клиентов.
* Изучение репутации: Благодаря упоминаниям о бренде, продукте в интернете можно выявить тенденции изменения настроения пользователей

## ML - цель
* Построить модель классификации текстов по трем категориям настроений: положительные, отрицательные, нейтральные.
* Построить модель для оценки эмоционального состояния клиента на основе текста запроса.

## Архитектура (по схеме C4)
![image](https://github.com/user-attachments/assets/7c38676f-c84f-4261-9b7e-c6a1292cd37a)


### Описание
Данная архитектура была выбрана с целью оптимизации запросов от пользователей. Архитектура обладает рядом преимуществ благодаря масштабируемости, производительности, модульности. Она представляет собой два микросервиса, что в свою очередь позволяет разделить задачи. Первый микросервис обрабатывает входящие HTTP-запросы, взаимодействует с Kafka, управляет кэшированием с помощью Redis. Также используется Ingress Controller как прокси для упрощения балансировки нагрузки и обеспечению гибкости в маршрутизации. Второй микросервис обрабатывает данные с помощью модели VADER, взаимодействует с Kafka. 

* Sentiment service - использует FastApi - производительный фреймворк без лишних инструментов "из коробки", что подходит
для решения небольшой задачи для обработки запросов пользователя.
* Predict service - использует модель VADER для анализа тональности текста. 
* Kafka - используется как брокер сообщений (в данном случае для коммуникации двух сервисов). Благодаря ей достигается
**асинхронность**, надежность доставки сообщений, задел на будущую масштабируемость, производительность.
* Redis - использовано для кэширования повторяющихся запросов. Удобен в силу отсутствия тяжелых данных. Ускоряет обработку повторяющихся запросов. 

## Используемый стек технологий

### Python + FastApi.
Использование Python + FastApi для реализации микросервиса обеспечивает быстрый и асинхронный подход к обработке входящих HTTP - запросов. FastApi отвечает за прием HTTP POST запросов, обрабатывая входные данные в формате JSON. FastAPI, благодаря своей производительности и использовании с асинхронным Python, позволяет создавать лёгкие и эффективные REST API, подходящие для микросервисных приложений.

### Python для взаимодействия с моделью VADER
Использование Python для взаимодействия с моделью анализа тональности VADER обеспечивает эффективную обработку текстов, благодаря встроенным библиотекам. Модель VADER - модель анализа тональности текстов, которая специализируется для обработки коротких текстов, что в нашем случае обеспечивает высокую производительность и точность для обработки текстов отзывов, комментариев. Модель также учитывает окрасывающие прилагательные, эмодзи, символы, что повышает точность определения тональности текста.

### Kafka
Использование Kafka в разработке микросервисов обеспечивает асинхронный обмен сообщениями между компонентами системы. Это позволяет взаимодействовать микросервисам независимо, обеспечивая производительность, устойчивость и масштабируемость.

### Redis
Использование Redis для кэширования результатов анализа тональности помогает избежать повторную обработку одних и тех же запросов, что помогает ускорить обработку. Redis используется благодаря его преимуществам в виде скорости, простоте использования и поддержке множеству типов данных, включая взаимодействие с JSON. Использование TTL позволяет избежать избыточного расхода памяти из-за бесконечного накопления данных в Redis. 

### Docker, kubernetes
Использование Docker для контейнеризации приложений и их зависимостей позволяет обеспечить одинаковую работу на различных устройствах. 

Использование Kubernetes предоставляет возможность для масштабирования приложения, автоматически регулирует ресурсы в зависимости от уровня нагрузки, повышет устройчивость и надежность, упрощает взаимодействия между компонентами системы. 

## Описание сетей (DMZ, Secure zone)

### DMZ (Demilitarized Zone)

- Сервисы: NGINX Ingress Controller
- Функция:
  - Обработка внешних HTTP/HTTPS-запросов, их маршрутизация к внутренним сервисам Kubernetes.
  - Управление SSL/TLS-сертификатами для шифрования соединений.
- Открытые порты:
  - `80` (HTTP) — для незашифрованных запросов.
  - `443` (HTTPS) — для зашифрованных запросов.
- Безопасность:
  - SSL/TLS для шифрования трафика.
  - Ограничение источников запросов (через IP-блоки, сетевые политики).
  - Лимитирование числа запросов для предотвращения DoS-атак.
  - Ограничение доступа к внутренним зонам через правила маршрутизации.

Так же вместо Ingress Controller можно использовать `port-forward` на sentiment-service (рекомендуется только
в целях локальной разработки/дебага, т.к. лишаемся всех плюсов из раздела "Безопасность").

### Secure Zone

- Сервисы: `sentiment-service`, `predict-service`, `redis`, `kafka`
- Функция:
  - Обработка бизнес-логики и выполнение запросов, перенаправленных через Ingress Controller.
- Открытые порты:
  - `8000` — sentiment-service (backend)
  - `6379` — Redis
  - `9092` — Kafka
- Безопасность:
  - Сетевые политики Kubernetes для ограничения трафика между подами.
  - Аутентификация и авторизация запросов, перенаправленных через Ingress Controller.
  - Потенциальные средства защиты для Redis (пароль) и Kafka (сертификаты, порт для защищенных соединений)

### Общее взаимодействие между зонами:

1. DMZ:
   - Получает внешние запросы и проверяет их с помощью правил маршрутизации, настроенных в Ingress.
   - Проксирует запросы к сервисам в Secure Zone.
2. Secure zone:
   - Получает запросы через внутренний сервис Kubernetes.
   - Ограничивает доступ к своим ресурсам с помощью сетевых политик.
   - Возвращает ответ обратно через Ingress Controller.

## Билд и деплой

Requirements:
- [Redis](https://redis.io/docs/latest/operate/oss_and_stack/install/)
- [Kafka](https://kafka.apache.org/quickstart)
- [Docker](https://docs.docker.com/engine/install/)
- [Python](https://www.python.org/downloads/) (v10 and higher)
- [Minikube & kubectl](https://minikube.sigs.k8s.io/docs/start)

1. **Сборка образов микросервисов**

    Перед сборкой необходимо удостовериться, что `minikube` запущен, а так же терминал настроен на работу с локальным
    Docker-демоном, запущенным внутри кластера Minikube:
    
    ```commandline
    minikube start --driver=docker
    ```
    ```commandline
    eval $(minikube docker-env)
    ```
    
    Теперь можно собрать образы:
    
    ```commandline
    docker build -t sentiment_service:latest backend/sentiment_service
    docker build -t predict_service:latest backend/predict_service
    ```

2. **Применяем манифесты для деплоя в k8s**

    ```commandline
    kubectl apply -f k8s/redis/
    kubectl apply -f k8s/zookeeper/
    kubectl apply -f k8s/kafka/
    kubectl apply -f k8s/predict-service/
    kubectl apply -f k8s/sentiment-service/
    ```

3. **Доступ к backend:**

- Опция 1 - port-forward (подходит для локальной разработки, дебага, может даже для дев стенда):
  ```commandline
  kubectl port-forward <sentimen-service-pod-name> <N>:8000
  ```
  После чего sentiment-service будет доступен по URL `localhost:N`


- Опция 2 - Ingress controller (подходит для прода):
    ```commandline
    kubectl apply -f k8s/ingress/
    ```
